<strong style="color: red; ">
※ 現在学習中で間違った内容を記載している可能性が大いにあります。もし間違いがありましたら、遠慮なくご指摘くださいませ。
</strong>

# IAM

AWSアカウントのサービス、リソースへのアクセス権限を安全に管理するためのもの。

全ての権限を持ったルートアカウントは便利な反面、全ての権限を持っているが故のリスクも大きいため、安全なAWS運用において、適切な権限を持ったユーザーを作成することは重要。

AWSアカウントを作成後は、IAMユーザーを作成し適切な権限設定を行った上で、開発を進めていく。

### IAM ポリシー

EC2を作成できる権限や、S3を閲覧できる権限、S3操作全てが可能な権限など、各種権限の設定を行うことができるJSON形式のファイル。

|  |  |
|:-:|:-:|
| Version  | 使用するポリシー言語のバージョン  |
| Id  | ポリシーで使用する名前（識別子）  |
| Statement  | 以下の項目を含むポリシーのメイン要素  |
| Sid  | ステートメントID  |
| Effect  | Allow: 許可、Deny: 拒否  |
| Principal  | リソースへのアクセス設定（ユーザー、アカウント、サービス等が含まれる）  |
| NotPrincipal  | リソースへのアクセスの拒否設定  |
| Action  | 対象のAWSサービス（例: "ec2:StartInstances"）  |
| NotAction  | アクセスを拒否する対象のAWSサービス  |
| Resource  | 対象のAWSリソース（AwsResourceNameで記載）  |
| NotResource  | アクセスを拒否する対象のAWSリソース  |
| Coundition  | アクセス制御が有効となる条件  |

ポリシー要素
- Version
- ID
- Statement
- Sid
- Principal
- NotPrincipal
- 

AWSが作成しているAWS管理ポリシーや、自分で作成するカスタマー管理ポリシーなどがある。

### IAMユーザー

ルートアカウントで日々の業務を遂行することは非推奨。そのため、適切なポリシーを持っているIAMユーザーで日々の業務遂行する。マネジメントコンソール（GUI）からのアクセスか、プログラム（コマンドライン）によるアクセスか、両方が可能かを選択できる。

プログラムによるアクセスを選択した際は、アクセスキーを流出させないように十分注意する。

ちなみに、IAMユーザーに直接ポリシーをアタッチする方法は推奨されていない。

#### ルートユーザー（アカウント）にしか権限が無い操作
- AWSルートアカウントのメールアドレスやパスワードの変更
- IAMユーザーの課金情報へのアクセスに関するactivate/deactivate
      - デフォルトではできないが、ルートアカウントで許可することでIAMユーザーでも可能となる
- 他のAWSアカウントへのRoute53のドメイン登録の変更
- AWSのサポートプランの変更
- AWSアカウントの停止
- コンソリデーテッドビリング（一括請求）の設定
- 脆弱性診断フォームの提出
- 逆引きDNSの申請
    - ドメイン名からIPアドレスを検索することを正引きと呼び、逆を逆引きと呼ぶ

### IAMグループ

複数のIAMユーザーのまとまり。グループごとに複数のポリシーをアタッチすることができる。そのため、IAMユーザーは所属するグループにアタッチされた権限を持つ。

つまり、IAMユーザーは自身にアタッチされたポリシーと所属グループにアタッチされたポリシーの両方の権限を持つ。

ちなみに、IAMユーザーは複数のグループに所属することができる。

組織単位での運用では、個別にポリシーをアタッチして運用することは非効率なため、基本的にはIAMグループを使用した運用を行う。

### IAM ロール

複数のポリシーがアタッチされたもので、主にサービスに割り当てて使用するもの。

IAMユーザーやグループは、ユーザーに対してのポリシーのアタッチだったのに対して、IAMロールではAWSサービス間リソース間に対してのアタッチである点が大きな違い。

作業の自動化などのさいに、複数ポリシーを有する必要のあるユーザーがいた場合、そのユーザーに複数のポリシーをアタッチするのではなく、サービスそのものにポリシーを割り当てる。（何となくわかるけど結構曖昧...）このサービスに対して誰が〜〜できる。

### IAMでのセキュリティのベストプラクティス

[公式ページ](https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/best-practices.html)より引用

- AWS アカウントのルートユーザー アクセスキーをロックする
    - 基本的にはルートユーザーを使用しない
- 個々の IAM ユーザーを作成する
- IAM ユーザーへのアクセス許可を割り当てるためにIAMグループを使用する
- IAMユーザーやグループには最小限の権限を認める
- AWS 管理ポリシーを使用したアクセス許可の使用
    - 基本的にはAWSが作成した管理ポリシーを使用する
- インラインポリシーではなくカスタマー管理ポリシーを使用する
    - [公式ページ](https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/access_policies_managed-vs-inline.html)
    - インラインポリシーは1対1で管理ポリシーは1対多
- アクセスレベルを使用して、IAM アクセス許可を確認する
- ユーザーのために強度の高いパスワードポリシーを設定する
- MFA の有効化
- Amazon EC2 インスタンスで実行するアプリケーションに対し、ロールを使用する
- ロールを使用してアクセス許可を委任する
- アクセスキーを共有しない
- 認証情報を定期的にローテーションする。
- 不要な認証情報の削除
- 追加セキュリティに対するポリシー条件を使用する。
- AWS アカウントのアクティビティの監視